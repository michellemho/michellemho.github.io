<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Home</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito|Roboto+Condensed" rel="stylesheet">    <link rel="stylesheet" href="/assets/css/styles.css">
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" />
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Home</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Home" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/" />
<meta property="og:url" content="http://localhost:4000/" />
<script type="application/ld+json">
{"@type":"WebSite","url":"http://localhost:4000/","headline":"Home","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>
  <body>
    <nav>
    <ul class="container">
        
            <li><a href="/" class="current">
                Home
            </a></li>
        
            <li><a href="/about.html" >
                About
            </a></li>
        
            <li><a href="/blog.html" >
                Posts
            </a></li>
        
            <li><a href="/crew.html" >
                Crew
            </a></li>
        
    </ul>
</nav>
    <h1>MICHELLE + GEOFF'S ROAD TRIP</h1>

<div id="mapid" style="width: 100%; margin: 0 auto 1em; height: 600px"></div>
<div id="loader">
		<div class="CDB-LoaderIcon CDB-LoaderIcon--big">
		  <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">
			<circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>
		  </svg>
		</div>
</div>
<script type="text/javascript" language="Javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css' rel='stylesheet' />
<script src="https://libs.cartocdn.com/carto-vl/v1.1.1/carto-vl.min.js"></script>
<link href="https://carto.com/developers/carto-vl/v0.10.0/examples/maps/style.css" rel="stylesheet">
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoibWljaGVsbGVtaG8iLCJhIjoiY2l2MWM0cWthMDA3NDJ5b3g3cGF5d2huaiJ9.2otqgGYhjK7bBnAhrnyu5A';

var map = new mapboxgl.Map({
  container: 'mapid',
  style: 'mapbox://styles/mapbox/bright-v9',
  center: [-98.5556199,39.8097343],
  zoom: 3.6
});
// Define pop-up
const popup = new mapboxgl.Popup({
	closeButton: false,
	closeOnClick: false
});

var url = '/map/map.geojson';
$.getJSON(url, function (geojson) {
	const places = geojson;
	const placesSource = new carto.source.GeoJSON(places);

	const viz = new carto.Viz(`
		@description: $description
    color: ramp($color, vivid)
		width: 20
		symbol: marker
		strokeWidth: 3
		strokeColor: white
	`);
	
	const places_layer = new carto.Layer('places_layer', placesSource, viz);
	
	places_layer.addTo(map);
	places_layer.on('loaded', hideLoader);

	const interactivity = new carto.Interactivity(places_layer);
    const delay = 50;
    let clickedFeatureId = null;
    interactivity.on('featureEnter', event => {
      event.features.forEach(feature => {
        if (feature.id !== clickedFeatureId) {
          feature.color.blendTo('opacity(DeepPink, 0.5)', delay)
          feature.strokeWidth.blendTo('4', delay);
          feature.strokeColor.blendTo('opacity(DeepPink, 0.8)', delay);
        }
      });
    });
    interactivity.on('featureLeave', event => {
      event.features.forEach(feature => {
        if (feature.id !== clickedFeatureId) {
          feature.color.reset(delay);
          feature.strokeWidth.reset(delay);
          feature.strokeColor.reset(delay);
        }
      });
    });
    interactivity.on('featureClick', event => {
      if (event.features.length) {
        const feature = event.features[0];
        clickedFeatureId = feature.id;
        feature.color.blendTo('opacity(LimeGreen, 0.5)', delay)
        feature.strokeWidth.blendTo('7', delay);
        feature.strokeColor.blendTo('opacity(LimeGreen, 0.8)', delay);
      }
    });
    interactivity.on('featureClickOut', event => {
      if (event.features.length) {
        const feature = event.features[0];
        clickedFeatureId = '';
        feature.color.reset(delay);
        feature.strokeWidth.reset(delay);
        feature.strokeColor.reset(delay);
      }
	});
	
	interactivity.on('featureClick', updatePopup);

});
function updatePopup(event) {
      if (event.features.length > 0) {
        const vars = event.features[0].variables;
        popup.setHTML(`${vars.description.value}`);
        popup.setLngLat([event.coordinates.lng, event.coordinates.lat]);
        if (!popup.isOpen()) {
          popup.addTo(map);
        }
      } else {
        popup.remove();
      }
}



function hideLoader() {
      document.getElementById('loader').style.opacity = '0';
    }

</script>
  </body>
</html>