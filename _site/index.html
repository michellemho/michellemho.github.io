<!doctype html>
<html>
  <head>
    <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0">     -->
    <meta charset="utf-8">
    <title>Geoff + Michelle Road Trip</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito|Roboto+Condensed" rel="stylesheet">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/styles.css">
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" />
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Geoff + Michelle Road Trip</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Geoff + Michelle Road Trip" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/" />
<meta property="og:url" content="http://localhost:4000/" />
<script type="application/ld+json">
{"@type":"WebSite","url":"http://localhost:4000/","headline":"Geoff + Michelle Road Trip","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    
</head>
  <body>
    <nav>
    <ul class="container">
        
            <li><a href="/" class="current">
                Map
            </a></li>
        
            <li><a href="/itinerary.html" >
                Itinerary
            </a></li>
        
            <li><a href="/blog.html" >
                Logbook
            </a></li>
        
            <li><a href="/crew.html" >
                Crew
            </a></li>
        
            <li><a href="/suggestions.html" >
                Suggestions
            </a></li>
        
    </ul>
</nav>
    <!-- <h1 style='margin-bottom: 5px'>MICHELLE + GEOFF'S ROAD TRIP 2019</h1> --><div id="mapid">
<aside class="toolbox" style="left: 24px; top: 55px">
    <div class="box">
        <header>
            <h1>Michelle + Geoff's Cross Country Road Trip 2019</h1>
        </header>
        <div>
            <p style='font-family: Nunito; text-align: justify; font-size: 12pt'>
              Click on locations to read about specific stops during our road trip.
              Have a suggestion of where we should go or just want to say hello?
              Send us a message and subscribe to this blog from the <a href='/suggestions.html'>suggestions</a> page; we'd love to hear from you!
            </p>
          </div>
        <!-- Add legend data -->
        <section>
            <div id="controls">
                <ul id="content"></ul>
            </div>
        </section>
    </div>
</aside>
<div id="loader">
		<div class="CDB-LoaderIcon CDB-LoaderIcon--big">
		  <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">
			<circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>
		  </svg>
		</div>
</div>
</div>
<script type="text/javascript" language="Javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css' rel='stylesheet' />
<script src="https://libs.cartocdn.com/carto-vl/v1.1.1/carto-vl.min.js"></script>
<link href="https://carto.com/developers/carto-vl/v0.10.0/examples/maps/style.css" rel="stylesheet">
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoibWljaGVsbGVtaG8iLCJhIjoiY2l2MWM0cWthMDA3NDJ5b3g3cGF5d2huaiJ9.2otqgGYhjK7bBnAhrnyu5A';

var map = new mapboxgl.Map({
  container: 'mapid',
  style: 'mapbox://styles/mapbox/bright-v9',
  center: [-105.5556199,37.97343],
  zoom: 3
});
// Define pop-up
const popup = new mapboxgl.Popup({
  className: "popups",
	closeButton: false,
  closeOnClick: false,
  anchor: 'left'
});

var url = '/map/map.geojson';
var line = '/map/line.geojson';

map.on('load', function(){
  $.getJSON(url, function (geojson) {
	const places = geojson;
	const placesSource = new carto.source.GeoJSON(places);

	const viz = new carto.Viz(`
    @past_or_future: $past_or_future
    @title: $title
    @excerpt: $excerpt
    @url: $url
    @place: $place
    @postdate: $date
    @coordinates: $coordinates
    @imgUrl: $imgUrl
    color: ramp(buckets($past_or_future, ['future','past']), [#ea0000,#00bc16])
		width: 20
		symbol: image('car.svg')
		strokeWidth: 3
    strokeColor: white
    
  `);
 
	
	const places_layer = new carto.Layer('places_layer', placesSource, viz);
	
  places_layer.addTo(map);

  // get line route
    $.getJSON(line, function(line_geojson){
      map.addLayer({
        id: 'the-route',
        type: 'line',
        source: {"type": "geojson",
          "data": line_geojson,
        },
        paint: {
          'line-color': 'magenta',
          'line-width': 3,
          'line-dasharray': [3, 3],
        },
      });
      hideLoader();
    }
    )
  
  places_layer.on('loaded', function() {
    const colorLegend = places_layer.viz.color.getLegendData();

    let symbolLegendList = '';

    colorLegend.data.forEach((legend, index) => {
      const symbol = places_layer.viz.symbol
      if (legend.key == 'CARTO_VL_OTHERS'){
        return;
      }
      const colorHex = rgbToHex(legend.value);
      symbolLegendList +=
        `
        <li>
            <span
                class="image-mark"
                style="
                  background-color: ${colorHex};
                  mask-image:url('./car.svg');
                  -webkit-mask-image:url('./car.svg');
                  mask-size: cover;
                  -webkit-mask-size: cover;
              "></span>
            <span style="font-size: 12pt; font-family:'Nunito'">${legend.key}</span>
        </li>
      `
      });
      document.getElementById('content').innerHTML = symbolLegendList;
        

      // fly to latest post.
      map.flyTo({
      center: [-124.6381, 48.09],
      zoom: 6,
      speed: 1
      });
      map.fire('flystart');


    });
  map.on('flystart', function(){
  flying = true;
    });
    map.on('flyend', function(){
        flying = false;
    });

   map.on('moveend', function(e){
   if(flying){
      // initial popup!
      popup.setHTML(`<div style='max-width: 250px'><h2><a href="/done/2019/05/20/olympic.html">Olympic National Park</a></h2>
                  <div class='small'>May 20 2019</div>
                  <div style="text-align: center"><a href="/done/2019/05/20/olympic.html"><img style="width:100%;" src=http://localhost:4000/assets/images/olympic/sunset_rialto.jpg></a></div>
            <p style="text-align: justify; margin: 0"> We decided to end our 3 month long road-trip with a multiday coastal backpacking trip in Olympic National Park. A final hurrah.

<a href="/done/2019/05/20/olympic.html">[read more]</a> </p> </div>       `
                  );
      popup.setLngLat([-124.6381, 48.09]);
      popup.addTo(map);
      map.fire('flyend');
      }
    });

	const interactivity = new carto.Interactivity(places_layer);
    const delay = 50;
    let clickedFeatureId = null;
    interactivity.on('featureEnter', event => {
      event.features.forEach(feature => {
        if (feature.id !== clickedFeatureId) {
          feature.color.blendTo('opacity(DeepPink, 0.5)', delay)
          feature.strokeWidth.blendTo('4', delay);
          feature.strokeColor.blendTo('opacity(DeepPink, 0.8)', delay);
        }
      });
    });
    interactivity.on('featureLeave', event => {
      event.features.forEach(feature => {
        if (feature.id !== clickedFeatureId) {
          feature.color.reset(delay);
          feature.strokeWidth.reset(delay);
          feature.strokeColor.reset(delay);
        }
      });
    });
    interactivity.on('featureClick', event => {
      if (event.features.length) {
        const feature = event.features[0];
        clickedFeatureId = feature.id;
        feature.color.blendTo('opacity(LimeGreen, 0.5)', delay)
        feature.strokeWidth.blendTo('7', delay);
        feature.strokeColor.blendTo('opacity(LimeGreen, 0.8)', delay);
      }
    });
    interactivity.on('featureClickOut', event => {
      if (event.features.length) {
        const feature = event.features[0];
        clickedFeatureId = '';
        feature.color.reset(delay);
        feature.strokeWidth.reset(delay);
        feature.strokeColor.reset(delay);
      }
	});
	
  interactivity.on('featureClick', updatePopup);
  interactivity.on('featureEnter', updatePopup);

});
})

function updatePopup(event) {
      if (event.features.length > 0) {
        const vars = event.features[0].variables;
        if (vars.past_or_future.value == 'future'){
          popup.setHTML(`<div style='max-width: 250px'><h2>${vars.place.value}</h2>
                            <div class='small'>${vars.postdate.value}</div>
                        </div>`);
        } else {
        popup.setHTML(`<div style='max-width: 250px'><h2><a href="${vars.url.value}">${vars.title.value}</a></h2>
                            <div class='small'>${vars.postdate.value}</div>
                            <div style="text-align: center"><a href="${vars.url.value}"><img style="width:100%;" src="${vars.imgUrl.value}"></a></div>
                            <p style="text-align: justify; margin: 0"> ${vars.excerpt.value} <a href="${vars.url.value}">[read more]</a></p> </div>`
                            );
        }
        popup.setLngLat([vars.coordinates.value.split(',')[0], vars.coordinates.value.split(',')[1]]);
        if (!popup.isOpen()) {
          popup.addTo(map);
        }
      } else {
        popup.remove();
      }
}

function rgbToHex(color) {
      return "#" + ((1 << 24) + (color.r << 16) + (color.g << 8) + color.b).toString(16).slice(1);
    }

function hideLoader() {
      document.getElementById('loader').style.opacity = '0';
    }

</script>
  </body>
</html>